# ИДЗ №2. Татаров Константин Манолисович БПИ 228
**Варинат 12\
Условие задания:**

Задача о супермаркете. В супермаркете работают два кассира,
покупатели заходят в супермаркет, делают покупки и становятся в очередь к случайному кассиру. Пока очередь пустая, кассир «спит». Как только появляется покупатель, кассир «просыпается».
Покупатель ожидает в очереди, пока не подойдет к кассиру. Очереди имеют ограниченную длину N. Если она длиннее, то покупатель
не встает ни в одну из очередей и уходит. Если одна из очередей
заполнена, то покупатель встает в другую.
Создать многопроцессное приложение, моделирующее рабочий день супермаркета.
Каждый покупатель и кассиры задаются отдельными процессами.


```
Первая программа на 4-5 балла:
Описание сценария и как он отображается в процессы и их взаимодействие:

- Создание общих ресурсов: В начале программы создаются общие ресурсы - разделяемая память и семафоры. Разделяемая память
используется для хранения информации о состоянии очередей, а семафоры используются для синхронизации доступа к этой
информации.
- Множество процессов взаимодействуют с использованием именованных POSIX семафоров.
- Создание кассиров: Затем создаются два процесса кассиров. Каждый кассир работает в своем собственном процессе. В цикле
cashier_process кассиры ждут появления покупателей в очереди. Когда покупатель появляется, кассир обслуживает его, уменьшая
длину очереди на 1 и затем ждет следующего покупателя.
- Создание покупателей: Далее создается группа из 18 процессов покупателей. Каждый покупатель также работает в своем собственном
процессе. В цикле customer_process покупатели пытаются войти в очередь к одному из кассиров. Если очередь не заполнена
(меньше MAX_QUEUE_LENGTH), покупатель встает в очередь и увеличивает ее длину на 1. Если очередь полна, покупатель уходит.
- Обработка сигнала SIGINT: Если пользователь отправляет сигнал SIGINT (обычно с помощью комбинации клавиш Ctrl+C), программа
обрабатывает сигнал и освобождает все ресурсы перед выходом.

Взаимодействие между процессами осуществляется через разделяемую память и семафоры. Кассиры и покупатели синхронизируют доступ к
разделяемой памяти с помощью семафоров, чтобы избежать гонок данных и обеспечить корректное управление очередями.
```

[Результаты тестирования программы](https://github.com/kkkkkostya/system-arch-hse/tree/84e420dfc61d1cc5753f7fd1277db38fd65b27bf/idz_os_2/prog4/test_results)

```
Программа на 6-7 баллов:
- В программе на данную оценку процессы взаимодействуют с использованием неименованных POSIX семафоров расположенных в разделяемой
памяти, в отличие от именнованных в предыдущей
- Основная логика взаимодействия осталась прежней
```

[Результаты тестирования](https://github.com/kkkkkostya/system-arch-hse/tree/84e420dfc61d1cc5753f7fd1277db38fd65b27bf/idz_os_2/prog6/test_results)

```
Программа на 8 баллов:
- В программе множество процессов независимых процессов взаимодействуют с использованием семафоров в стандарте UNIX SYSTEM V и
обмен данными происходит через разделяемую память
-Создание разделяемой памяти (Shared Memory):
Программа вызывает функцию shmget для создания сегмента разделяемой памяти.
Функция shmget принимает несколько параметров, включая ключ (SHM_KEY), размер памяти и флаги доступа.
Если сегмент разделяемой памяти успешно создан, он возвращает идентификатор (shmid).
- Подключение к разделяемой памяти:
Программа вызывает функцию shmat, передавая идентификатор разделяемой памяти (shmid).
Функция shmat возвращает указатель на сегмент разделяемой памяти.
Теперь все процессы могут получить доступ к этому сегменту памяти, используя этот указатель.
- Создание семафоров (Semaphores):
Программа вызывает функцию semget для создания массива семафоров.
Функция semget принимает несколько параметров, включая ключ (SEM_KEY), количество семафоров в массиве и флаги доступа.
Если массив семафоров успешно создан, он возвращает идентификатор (semid).
- Инициализация семафоров:
Программа вызывает функцию semctl для установки начальных значений семафоров.
Начальные значения семафоров определяют доступность разделяемых ресурсов.
- Создание процессов:
Программа создает процессы кассиров и покупателей с помощью функции fork.
В каждом процессе происходит подключение к разделяемой памяти и семафорам с помощью shmat и semget.
Взаимодействие через разделяемую память и семафоры:
Каждый процесс, работающий с очередью (как кассиры, так и покупатели), читает и записывает информацию о состоянии очереди в
разделяемую память.
Процессы используют семафоры для синхронизации доступа к разделяемой памяти, чтобы избежать гонок данных и обеспечить корректное
управление очередями.
- Освобождение ресурсов:
После завершения работы программы или по запросу пользователя (например, сигнал SIGINT), процессы освобождают ресурсы.
Это включает отключение от разделяемой памяти с помощью shmdt, удаление семафоров с помощью semctl, и удаление разделяемой памяти
с помощью shmctl.

Таким образом, процессы создаются, обмениваются данными и синхронизируют свою работу с помощью разделяемой памяти и семафоров, что
позволяет им эффективно моделировать рабочий день в супермаркете.
```

[Результаты тестирования](https://github.com/kkkkkostya/system-arch-hse/tree/84e420dfc61d1cc5753f7fd1277db38fd65b27bf/idz_os_2/prog8/test_results)
